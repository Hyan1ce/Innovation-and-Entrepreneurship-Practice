sudo apt-get install git g++ apt-utils autoconf automake build-essential libcurl4-openssl-dev libgeoip-dev liblmdb-dev libpcre++-dev libtool libxml2-dev libyajl-dev pkgconf wget zlib1g-dev
git clone https://github.com/SpiderLabs/ModSecurity
cd ModSecurity/
git submodule init
git submodule update
sh build.sh
./configure
make
make install
cd ~
git clone https://github.com/SpiderLabs/ModSecurity-nginx.git
wget http://nginx.org/download/nginx-1.22.0.tar.gz
tar -zxvf nginx-1.22.0.tar.gz
cd nginx-1.22.0/
./configure --add-module=root/ModSecurity-nginx --prefix=/usr/local/nginx
make
make install
sudo mkdir /usr/local/nginx/modsec
cd ~/ModSecurity-nginx/
sudo mv modsecurity.conf-recommended /usr/local/nginx/modsec/modsecurity.conf
sudo mv unicode.mapping /usr/local/nginx/modsec/unicode.mapping
sed -i \'7s/DetectionOnly/On/g\' /usr/local/nginx/modsec/modsecurity.conf
Include /usr/local/nginx/modsec/modsecurity.conf
SecRule ARGS: id"@contains users#" "id:1234,deny,log,status:403"
vi /usr/local/nginx/conf/nginx.conf
<script>alert(/xss/)</script>

Include /usr/local/nginx/modsec/modsecurity.conf
vi /usr/local/nginx/modsec/main.conf
/usr/local/nginx/sbin/nginx -s reload
SecRule FILE:name "@contains .png" "id:2255,deny,log,status:403"

SecRule FILES "!\\.(?i:jpe?g|gif|png|bmp)$"
"deny,tag:'WEB_ATTACK/FILEUPLOAD',msg:'upload
no-picture file',id:0000001,phase:2"
SecRule FILES "@contains .php" "id:1123,deny,log,status:403"
SecRule FILES "!\\.(?i:jpe?g|gif|png|bmp)$" "id:1122,deny,log,status:403"
SecRule FILES "!\\.(?i:jpe?g|gif|png|bmp)$" "deny,tag:'WEB_ATTACK/FILEUPLOAD',msg:'upload no-picture file',id:1122,phase:2"